var mongoose=require("mongoose"),Schema=mongoose.Schema,LineItemSchema=new Schema({order:{type:Schema.Types.ObjectId,ref:"Order",required:!0},product:{type:Schema.Types.ObjectId,ref:"Product",required:!0},count:{type:Number,required:!0,"default":1}},{timestamps:{}});
LineItemSchema.statics.incrementOrCreate=function(c,e,b){var f=this;this.findOne({order:c,product:e}).exec(function(a,d){if(a)return b(a);if(d)return console.log("INCREMENT line item"),d.count++,d.save(),b(null,d);console.log("CREATE new line item");f.create({order:c,product:e}).then(function(a){return b(null,a)})})};
LineItemSchema.statics.decrementOrRemove=function(c,e,b){this.findOne({order:c,product:e}).exec(function(c,a){if(c)return b(c);if(a){if(1===a.count){console.log("DESTROY line item");var d=a.remove();return b(null,d)}console.log("DECREMENT line item");a.count--;a.save();return b(null,a)}return b("line item doesnt exist")})};module.exports=mongoose.model("LineItem",LineItemSchema);
