var mongoose=require("mongoose"),bcrypt=require("bcrypt"),Schema=mongoose.Schema,UserSchema=new Schema({username:{type:String,required:!0,maxlength:30,minlength:4,unique:!0,trim:!0},password:{type:String,required:!0}},{timestamps:{}});UserSchema.pre("save",function(a){var c=this;bcrypt.hash(c.password,10,function(b,e){if(b)return a(b);c.password=e;return a()})});
UserSchema.statics.auth=function(a,c,b){this.findOne({username:a}).exec(function(a,d){if(a)return b(a);if(!d)return b("User not found.");bcrypt.compare(c,d.password,function(a,c){return!0===c?b(null,d._id):b("Password is incorrect")})})};module.exports=mongoose.model("User",UserSchema);
