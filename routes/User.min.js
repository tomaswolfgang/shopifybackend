var express=require("express"),router=express.Router(),User=require("../mongoose/User"),Middleware=require("./middleware.js");router.post("/user/find",function(a,b){User.findById(a.body.id).exec(function(a,c){a||!c?b.send({error:!0,message:"Could not find user"}):b.send({error:!1,message:"user was found",user:c})})});
router.post("/user/create",function(a,b){a.body.username&&a.body.password&&User.findOne({username:a.body.username}).exec(function(d,c){null!==c?b.send({error:!0,message:"user already exists!"}):(c=new User({username:a.body.username,password:a.body.password,orders:[],cart:[]}),c.save(function(d,e){d?b.send({error:!0,message:"Error when saving user"}):(console.log("User saved successfully "),a.session.userId=c._id,b.send({error:!1,message:"user create success",userId:c._id}))}))})});
router.post("/user/login",function(a,b){a.body.username&&a.body.password?User.auth(a.body.username,a.body.password,function(d,c){d?b.send({error:!0,message:d}):(a.session.userId=c,b.send({error:!1,message:"login success"}))}):b.send({error:!0,message:"request is incomplete (missing username or password)"})});router.post("/user/logout",Middleware,function(a,b){a.session?a.session.destroy(function(a){a?b.send({error:!0,message:a}):b.send({error:!1,message:"logout success"})}):b.send({error:!0,message:"you must be logged in to logout"})});
module.exports=router;
