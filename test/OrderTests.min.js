var $jscomp={scope:{},executeAsyncGenerator:function(b){function a(a){return b.next(a)}function e(a){return b["throw"](a)}return new Promise(function(d,f){function r(c){c.done?d(c.value):Promise.resolve(c.value).then(a,e).then(r,f)}r(b.next())})}};$jscomp.defineProperty="function"==typeof Object.defineProperties?Object.defineProperty:function(b,a,e){if(e.get||e.set)throw new TypeError("ES3 does not support getters and setters.");b!=Array.prototype&&b!=Object.prototype&&(b[a]=e.value)};
$jscomp.getGlobal=function(b){return"undefined"!=typeof window&&window===b?b:"undefined"!=typeof global&&null!=global?global:b};$jscomp.global=$jscomp.getGlobal(this);$jscomp.SYMBOL_PREFIX="jscomp_symbol_";$jscomp.initSymbol=function(){$jscomp.initSymbol=function(){};$jscomp.global.Symbol||($jscomp.global.Symbol=$jscomp.Symbol)};$jscomp.symbolCounter_=0;$jscomp.Symbol=function(b){return $jscomp.SYMBOL_PREFIX+(b||"")+$jscomp.symbolCounter_++};
$jscomp.initSymbolIterator=function(){$jscomp.initSymbol();var b=$jscomp.global.Symbol.iterator;b||(b=$jscomp.global.Symbol.iterator=$jscomp.global.Symbol("iterator"));"function"!=typeof Array.prototype[b]&&$jscomp.defineProperty(Array.prototype,b,{configurable:!0,writable:!0,value:function(){return $jscomp.arrayIterator(this)}});$jscomp.initSymbolIterator=function(){}};$jscomp.arrayIterator=function(b){var a=0;return $jscomp.iteratorPrototype(function(){return a<b.length?{done:!1,value:b[a++]}:{done:!0}})};
$jscomp.iteratorPrototype=function(b){$jscomp.initSymbolIterator();b={next:b};b[$jscomp.global.Symbol.iterator]=function(){return this};return b};$jscomp.makeIterator=function(b){$jscomp.initSymbolIterator();var a=b[Symbol.iterator];return a?a.call(b):$jscomp.arrayIterator(b)};
$jscomp.polyfill=function(b,a,e,d){if(a){e=$jscomp.global;b=b.split(".");for(d=0;d<b.length-1;d++){var f=b[d];f in e||(e[f]={});e=e[f]}b=b[b.length-1];d=e[b];a=a(d);a!=d&&null!=a&&$jscomp.defineProperty(e,b,{configurable:!0,writable:!0,value:a})}};$jscomp.EXPOSE_ASYNC_EXECUTOR=!0;$jscomp.FORCE_POLYFILL_PROMISE=!1;
$jscomp.polyfill("Promise",function(b){function a(){this.batch_=null}if(b&&!$jscomp.FORCE_POLYFILL_PROMISE)return b;a.prototype.asyncExecute=function(a){null==this.batch_&&(this.batch_=[],this.asyncExecuteBatch_());this.batch_.push(a);return this};a.prototype.asyncExecuteBatch_=function(){var a=this;this.asyncExecuteFunction(function(){a.executeBatch_()})};var e=$jscomp.global.setTimeout;a.prototype.asyncExecuteFunction=function(a){e(a,0)};a.prototype.executeBatch_=function(){for(;this.batch_&&this.batch_.length;){var a=
this.batch_;this.batch_=[];for(var c=0;c<a.length;++c){var b=a[c];delete a[c];try{b()}catch(g){this.asyncThrow_(g)}}}this.batch_=null};a.prototype.asyncThrow_=function(a){this.asyncExecuteFunction(function(){throw a;})};var d=function(a){this.state_=0;this.result_=void 0;this.onSettledCallbacks_=[];var c=this.createResolveAndReject_();try{a(c.resolve,c.reject)}catch(t){c.reject(t)}};d.prototype.createResolveAndReject_=function(){function a(a){return function(r){b||(b=!0,a.call(c,r))}}var c=this,b=
!1;return{resolve:a(this.resolveTo_),reject:a(this.reject_)}};d.prototype.resolveTo_=function(a){if(a===this)this.reject_(new TypeError("A Promise cannot resolve to itself"));else if(a instanceof d)this.settleSameAsPromise_(a);else{var c;a:switch(typeof a){case "object":c=null!=a;break a;case "function":c=!0;break a;default:c=!1}c?this.resolveToNonPromiseObj_(a):this.fulfill_(a)}};d.prototype.resolveToNonPromiseObj_=function(a){var c=void 0;try{c=a.then}catch(t){this.reject_(t);return}"function"==
typeof c?this.settleSameAsThenable_(c,a):this.fulfill_(a)};d.prototype.reject_=function(a){this.settle_(2,a)};d.prototype.fulfill_=function(a){this.settle_(1,a)};d.prototype.settle_=function(a,c){if(0!=this.state_)throw Error("Cannot settle("+a+", "+c|"): Promise already settled in state"+this.state_);this.state_=a;this.result_=c;this.executeOnSettledCallbacks_()};d.prototype.executeOnSettledCallbacks_=function(){if(null!=this.onSettledCallbacks_){for(var a=this.onSettledCallbacks_,c=0;c<a.length;++c)a[c].call(),
a[c]=null;this.onSettledCallbacks_=null}};var f=new a;d.prototype.settleSameAsPromise_=function(a){var c=this.createResolveAndReject_();a.callWhenSettled_(c.resolve,c.reject)};d.prototype.settleSameAsThenable_=function(a,c){var b=this.createResolveAndReject_();try{a.call(c,b.resolve,b.reject)}catch(g){b.reject(g)}};d.prototype.then=function(a,c){function b(a,c){return"function"==typeof a?function(c){try{g(a(c))}catch(h){e(h)}}:c}var g,e,f=new d(function(a,c){g=a;e=c});this.callWhenSettled_(b(a,g),
b(c,e));return f};d.prototype["catch"]=function(a){return this.then(void 0,a)};d.prototype.callWhenSettled_=function(a,c){function b(){switch(d.state_){case 1:a(d.result_);break;case 2:c(d.result_);break;default:throw Error("Unexpected state: "+d.state_);}}var d=this;null==this.onSettledCallbacks_?f.asyncExecute(b):this.onSettledCallbacks_.push(function(){f.asyncExecute(b)})};d.resolve=function(a){return a instanceof d?a:new d(function(c,b){c(a)})};d.reject=function(a){return new d(function(c,b){b(a)})};
d.race=function(a){return new d(function(c,b){for(var e=$jscomp.makeIterator(a),f=e.next();!f.done;f=e.next())d.resolve(f.value).callWhenSettled_(c,b)})};d.all=function(a){var b=$jscomp.makeIterator(a),e=b.next();return e.done?d.resolve([]):new d(function(a,c){function f(b){return function(c){g[b]=c;n--;0==n&&a(g)}}var g=[],n=0;do g.push(void 0),n++,d.resolve(e.value).callWhenSettled_(f(g.length-1),c),e=b.next();while(!e.done)})};$jscomp.EXPOSE_ASYNC_EXECUTOR&&(d.$jscomp$new$AsyncExecutor=function(){return new a});
return d},"es6-impl","es3");var request=require("request"),assert=require("assert"),chai=require("chai"),chaiHttp=require("chai-http"),base_url="http://localhost:3000/",server=require("../server"),User=require("../mongoose/User"),Shop=require("../mongoose/Shop"),Product=require("../mongoose/Product"),Order=require("../mongoose/Order"),LineItem=require("../mongoose/LineItem"),product1Price=10,product2Price=25;chai.use(chaiHttp);
describe("Order functionality",function(){beforeEach(function(b){Promise.resolve(Shop.collection.drop()).then(Product.collection.drop()).then(User.collection.drop()).then(function(){(new User({username:"tommy",password:"asdf"})).save()}).then(function(){var a=new Shop({name:"TommyStore"});a.save().then(function(){(new Product({name:"test1",price:product1Price,description:"first product test",shop:a._id})).save(function(e){(new Product({name:"test2",price:product2Price,description:"second product test",
shop:a._id})).save(function(a){b()})})},function(a){console.log("error when saving new product")})})["catch"](function(a){return console.log("before each order func error")})});describe("User Actions",function(){beforeEach(function(b){Promise.resolve(Order.collection.drop()).then(LineItem.collection.drop()).then(b())["catch"](function(a){return console.log("before each user add error",a)})});it("ORDER : user can add to cart",function(){return $jscomp.executeAsyncGenerator(function(){function b(b,
k){for(;;)switch(a){case 0:return h=chai.request.agent(base_url),a=1,{value:h.post("user/login").send({username:"tommy",password:"asdf"}),done:!1};case 1:if(void 0===k){a=2;break}a=-1;throw k;case 2:return a=3,{value:h.get("product/getAll"),done:!1};case 3:if(void 0===k){a=4;break}a=-1;throw k;case 4:return n=z=b,w=n.body,l=w.products,a=5,{value:h.post("order/add").send({shopId:l[0].shop,productId:l[0]._id}),done:!1};case 5:if(void 0===k){a=6;break}a=-1;throw k;case 6:return g=y=b,assert(!g.body.error,
g.body.message),assert.equal(product1Price,g.body.order.price),console.log("add product success, current order price",g.body.order.price),a=7,{value:h.post("order/add").send({shopId:l[1].shop,productId:l[1]._id}),done:!1};case 7:if(void 0===k){a=8;break}a=-1;throw k;case 8:return c=t=b,assert(!c.body.error,c.body.message),assert.equal(product1Price+product2Price,c.body.order.price),console.log("2nd add product success, current order price",c.body.order.price),a=9,{value:h.post("order/add").send({shopId:l[0].shop,
productId:l[0]._id}),done:!1};case 9:if(void 0===k){a=10;break}a=-1;throw k;case 10:return f=r=b,assert(!f.body.error,f.body.message),assert.equal(product1Price+product1Price+product2Price,f.body.order.price),console.log("3nd add product success, can add single product multiple times, current order price",f.body.order.price),a=11,{value:h.post("user/logout"),done:!1};case 11:if(void 0===k){a=12;break}a=-1;throw k;case 12:e=d=b,assert(!e.body.error,e.body.message),a=-1;default:return{value:void 0,
done:!0}}}var a=0,e,d,f,r,c,t,g,y,l,w,n,z,h,v={next:function(a){return b(a,void 0)},"throw":function(a){return b(void 0,a)},"return":function(a){throw Error("Not yet implemented");}};$jscomp.initSymbolIterator();v[Symbol.iterator]=function(){return this};return v}())});it("ORDER : user can remove from cart",function(){return $jscomp.executeAsyncGenerator(function(){function b(b,p){for(;;)switch(a){case 0:return u=chai.request.agent(base_url),a=1,{value:u.post("user/login").send({username:"tommy",
password:"asdf"}),done:!1};case 1:if(void 0===p){a=2;break}a=-1;throw p;case 2:return a=3,{value:u.get("product/getAll"),done:!1};case 3:if(void 0===p){a=4;break}a=-1;throw p;case 4:return B=q=b,A=B.body,m=A.products,a=5,{value:u.post("order/add").send({shopId:m[0].shop,productId:m[0]._id}),done:!1};case 5:if(void 0===p){a=6;break}a=-1;throw p;case 6:return x=k=b,assert(!x.body.error,x.body.message),assert.equal(product1Price,x.body.order.price),console.log("add product success, current order price",
x.body.order.price),a=7,{value:u.post("order/add").send({shopId:m[1].shop,productId:m[1]._id}),done:!1};case 7:if(void 0===p){a=8;break}a=-1;throw p;case 8:return h=v=b,assert(!h.body.error,h.body.message),assert.equal(product1Price+product2Price,h.body.order.price),console.log("2nd add product success, current order price",h.body.order.price),a=9,{value:u.post("order/remove").send({shopId:m[1].shop,productId:m[1]._id}),done:!1};case 9:if(void 0===p){a=10;break}a=-1;throw p;case 10:return n=z=b,assert(!n.body.error,
n.body.message),assert.equal(product1Price,n.body.order.price),console.log("1st remove product success, can remove product in an order, current order price",n.body.order.price),a=11,{value:u.post("order/add").send({shopId:m[0].shop,productId:m[0]._id}),done:!1};case 11:if(void 0===p){a=12;break}a=-1;throw p;case 12:return l=w=b,assert(!l.body.error,l.body.message),assert.equal(product1Price+product1Price,l.body.order.price),console.log("3nd add product success, can add single product multiple times, current order price",
l.body.order.price),a=13,{value:u.post("order/remove").send({shopId:m[0].shop,productId:m[0]._id}),done:!1};case 13:if(void 0===p){a=14;break}a=-1;throw p;case 14:return g=y=b,assert(!g.body.error,g.body.message),assert.equal(product1Price,g.body.order.price),console.log("2nd remove product success, can remove single product that is repeated multiple times in the order, current order price",g.body.order.price),a=15,{value:u.post("order/remove").send({shopId:m[0].shop,productId:m[0]._id}),done:!1};
case 15:if(void 0===p){a=16;break}a=-1;throw p;case 16:return c=t=b,assert(!c.body.error,c.body.message),assert.equal(0,c.body.order.price),console.log("3rd remove product success, can remove last product in order, current order price",c.body.order.price),a=17,{value:u.post("order/remove").send({shopId:m[0].shop,productId:m[0]._id}),done:!1};case 17:if(void 0===p){a=18;break}a=-1;throw p;case 18:return f=r=b,assert(f.body.error,"Was able to remove product from empty order"),console.log("Error when removing product from empty order: ",
f.body.message),a=19,{value:u.post("user/logout"),done:!1};case 19:if(void 0===p){a=20;break}a=-1;throw p;case 20:e=d=b,assert(!e.body.error,e.body.message),a=-1;default:return{value:void 0,done:!0}}}var a=0,e,d,f,r,c,t,g,y,l,w,n,z,h,v,x,k,m,A,B,q,u,C={next:function(a){return b(a,void 0)},"throw":function(a){return b(void 0,a)},"return":function(a){throw Error("Not yet implemented");}};$jscomp.initSymbolIterator();C[Symbol.iterator]=function(){return this};return C}())});it("ORDER : can see products in order",
function(){return $jscomp.executeAsyncGenerator(function(){function b(b,k){for(;;)switch(a){case 0:return h=chai.request.agent(base_url),a=1,{value:h.post("user/login").send({username:"tommy",password:"asdf"}),done:!1};case 1:if(void 0===k){a=2;break}a=-1;throw k;case 2:return a=3,{value:h.get("product/getAll"),done:!1};case 3:if(void 0===k){a=4;break}a=-1;throw k;case 4:return n=z=b,w=n.body,l=w.products,a=5,{value:h.post("order/add").send({shopId:l[0].shop,productId:l[0]._id}),done:!1};case 5:if(void 0===
k){a=6;break}a=-1;throw k;case 6:return g=y=b,assert(!g.body.error,g.body.message),assert.equal(product1Price,g.body.order.price),console.log("add product success, current order price",g.body.order.price),a=7,{value:h.post("order/add").send({shopId:l[1].shop,productId:l[1]._id}),done:!1};case 7:if(void 0===k){a=8;break}a=-1;throw k;case 8:return c=t=b,assert(!c.body.error,c.body.message),assert.equal(product1Price+product2Price,c.body.order.price),console.log("add product success, current order price",
c.body.order.price),a=9,{value:h.post("order/getProducts").send({orderId:c.body.order._id}),done:!1};case 9:if(void 0===k){a=10;break}a=-1;throw k;case 10:return f=r=b,assert(!f.body.error,f.body.message),console.log("products in my order",f.body.products.length),assert.equal(2,f.body.products.length),a=11,{value:h.post("user/logout"),done:!1};case 11:if(void 0===k){a=12;break}a=-1;throw k;case 12:e=d=b,assert(!e.body.error,e.body.message),a=-1;default:return{value:void 0,done:!0}}}var a=0,e,d,f,
r,c,t,g,y,l,w,n,z,h,v={next:function(a){return b(a,void 0)},"throw":function(a){return b(void 0,a)},"return":function(a){throw Error("Not yet implemented");}};$jscomp.initSymbolIterator();v[Symbol.iterator]=function(){return this};return v}())});it("CHECKOUT: can checkout successfully",function(){return $jscomp.executeAsyncGenerator(function(){function b(b,q){for(;;)switch(a){case 0:return m=chai.request.agent(base_url),a=1,{value:m.post("user/login").send({username:"tommy",password:"asdf"}),done:!1};
case 1:if(void 0===q){a=2;break}a=-1;throw q;case 2:return a=3,{value:m.get("product/getAll"),done:!1};case 3:if(void 0===q){a=4;break}a=-1;throw q;case 4:return x=k=b,v=x.body,h=v.products,a=5,{value:m.post("order/add").send({shopId:h[0].shop,productId:h[0]._id}),done:!1};case 5:if(void 0===q){a=6;break}a=-1;throw q;case 6:return n=z=b,assert(!n.body.error,n.body.message),assert.equal(product1Price,n.body.order.price),console.log("add product success, current order price",n.body.order.price),a=7,
{value:m.post("order/add").send({shopId:h[1].shop,productId:h[1]._id}),done:!1};case 7:if(void 0===q){a=8;break}a=-1;throw q;case 8:return l=w=b,assert(!l.body.error,l.body.message),assert.equal(product1Price+product2Price,l.body.order.price),console.log("add product success, current order price",l.body.order.price),a=9,{value:m.post("order/checkout").send({shopId:h[0].shop}),done:!1};case 9:if(void 0===q){a=10;break}a=-1;throw q;case 10:return g=y=b,assert(!g.body.error,g.body.message),assert(!g.body.order.active,
"order was still active after checkout"),a=11,{value:m.post("order/add").send({shopId:h[0].shop,productId:h[0]._id}),done:!1};case 11:if(void 0===q){a=12;break}a=-1;throw q;case 12:return c=t=b,assert(!c.body.error,c.body.message),assert.equal(product1Price,c.body.order.price),console.log("add product success, current order price",c.body.order.price),a=13,{value:m.post("order/get").send({shopId:h[0].shop}),done:!1};case 13:if(void 0===q){a=14;break}a=-1;throw q;case 14:return f=r=b,assert(!f.body.error,
f.body.message),assert.equal(2,f.body.orders.length),console.log("all orders (should have 2 total)",f.body.orders),a=15,{value:m.post("user/logout"),done:!1};case 15:if(void 0===q){a=16;break}a=-1;throw q;case 16:e=d=b,assert(!e.body.error,e.body.message),a=-1;default:return{value:void 0,done:!0}}}var a=0,e,d,f,r,c,t,g,y,l,w,n,z,h,v,x,k,m,A={next:function(a){return b(a,void 0)},"throw":function(a){return b(void 0,a)},"return":function(a){throw Error("Not yet implemented");}};$jscomp.initSymbolIterator();
A[Symbol.iterator]=function(){return this};return A}())})})});
